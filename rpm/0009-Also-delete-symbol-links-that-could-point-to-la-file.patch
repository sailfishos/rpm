From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Bj=C3=B6rn=20Bidar?= <bjorn.bidar@jolla.com>
Date: Mon, 8 Jan 2024 04:21:59 +0200
Subject: [PATCH] Also delete symbol links that could point to la-files
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

la files can be shipped as symbolic links and as file.
Both should be deleted and the symbolic link shouldn't be followed
as it will be invalid.

Signed-off-by: Bj√∂rn Bidar <bjorn.bidar@jolla.com>
---
 scripts/brp-remove-la-files | 7 +++++++
 1 file changed, 7 insertions(+)

diff --git a/scripts/brp-remove-la-files b/scripts/brp-remove-la-files
index 58c513bf8..ec2832df5 100755
--- a/scripts/brp-remove-la-files
+++ b/scripts/brp-remove-la-files
@@ -8,3 +8,10 @@ fi
 find "$RPM_BUILD_ROOT" -type f -name '*.la' 2>/dev/null -print0 |
   xargs -0 grep --fixed-strings '.la - a libtool library file' --files-with-matches --null |
   xargs -0 rm --force
+
+find "$RPM_BUILD_ROOT" -type l -name '*.la' 2>/dev/null -print0 |
+  xargs -0 file |
+  grep "broken symbolic link" |
+  awk -F'[: ]' '{print $1}' |
+  xargs rm --force
+  
\ No newline at end of file
